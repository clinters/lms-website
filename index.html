<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LMS Registration</title>
  <style>
    :root{
      --bg:#0e1024; --panel:#14183a; --brand:#6a0dad; --text:#eef1ff; --muted:#a7a9c6;
      --ok:#10b981; --err:#ef4444; --border:rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1100px 520px at 80% -10%, #1b1d47 0%, #0e1024 50%, #0a0b1b 100%);color:var(--text);font:16px/1.6 system-ui,Segoe UI,Inter,Roboto,Arial,sans-serif}
    .wrap{max-width:720px;margin:48px auto;padding:0 20px}
    h1{margin:0 0 16px;text-align:center}
    .sub{color:var(--muted);text-align:center;margin:0 0 28px}
    form{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid var(--border);border-radius:14px;padding:20px}
    label{display:block;margin:.6rem 0 .3rem}
    input,button{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:#0f1230;color:#eef1ff}
    input:focus,button:focus{outline:2px solid var(--brand);outline-offset:2px}
    button{border:none;background:linear-gradient(180deg,#7a1ee0,#6a0dad);font-weight:700;cursor:pointer;margin-top:10px}
    button[disabled]{opacity:.6;cursor:not-allowed}
    .row{display:flex;gap:.5rem;align-items:center;margin-top:10px}
    .row input[type="checkbox"]{width:auto}
    .msg{display:none;margin-top:12px;padding:12px;border-radius:10px;text-align:center}
    .msg.ok{display:block;background:rgba(16,185,129,.12);border:1px solid rgba(16,185,129,.4);color:#d1fae5}
    .msg.err{display:block;background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.4);color:#fee2e2}
    .links{margin-top:10px;text-align:center}
    .links a{color:#7ab3ff;text-decoration:none;margin:0 6px;cursor:pointer}
    /* modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:20px;z-index:50}
    .modal.open{display:flex}
    .card{max-width:720px;width:min(720px,100%);background:#0f112c;border:1px solid var(--border);border-radius:14px;padding:18px}
    .card h3{margin:.2rem 0 10px}
    .close{float:right;background:#1e224f;border:none;color:#fff;padding:.35rem .6rem;border-radius:8px;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>LMS Sports Club – Join</h1>
    <p class="sub">Private, invitation‑only weekly Premier League selections via WhatsApp.</p>

    <form id="reg" novalidate>
      <label for="name">Name</label>
      <input id="name" name="name" type="text" required placeholder="Alex Smith" />

      <label for="phone">WhatsApp number (incl. country code)</label>
      <input id="phone" name="phone" type="tel" inputmode="tel" required placeholder="+447712345678" />

      <label for="email">Email (optional)</label>
      <input id="email" name="email" type="email" placeholder="you@example.com" />

      <div class="row">
        <input type="checkbox" id="agree" name="agree" required>
        <label for="agree">I agree to the <a id="openRules">Rules</a> and <a id="openPrivacy">Privacy Policy</a>.</label>
      </div>

      <button id="submitBtn" type="submit">Register</button>
      <div id="msg" class="msg" aria-live="polite"></div>
    </form>

    <div class="links">
      <a id="openRules2">Rules</a> • <a id="openPrivacy2">Privacy Policy</a>
    </div>
  </div>

  <!-- Rules Modal -->
  <div id="modalRules" class="modal">
    <div class="card">
      <button class="close" data-close>Close</button>
      <h3>Rules</h3>
      <ul>
        <li>For each full set of fixtures you choose ONE Prem League team to WIN. A defeat or a draw and you lose a life.</li>
        <li>Your entry gets 2 lives so fear not, a naff selection in Week 1 and you're still in the game!</li>
        <li>Deadline each week (normally Friday 6pm). Forget and your default will be the highest‑placed unused team.</li>
        <li>You cannot use the same team twice unless a game lasts 20+ weeks.</li>
        <li>If a game is postponed after the deadline, Pools Panel result applies. Before deadline ⇒ pick again.</li>
        <li>Pot split allowed late game if all agree; otherwise play continues. Rollover if no winner.</li>
        <li>Last person left wins the pot.</li>
      </ul>
    </div>
  </div>

  <!-- Privacy Modal -->
  <div id="modalPrivacy" class="modal">
    <div class="card">
      <button class="close" data-close>Close</button>
      <h3>Privacy Policy</h3>
      <p><strong>Data we collect:</strong> name, WhatsApp number, and (optional) email to run weekly selections (record choices, send fixtures and confirmations).</p>
      <p><strong>How it’s used:</strong> opt‑in, transactional messages only (no marketing, no third‑party sharing).</p>
      <p><strong>Retention:</strong> stored in Google Sheets for the current cycle and up to 12 months for audit, then removed.</p>
      <p><strong>Your choices:</strong> request access/correction/deletion anytime via the admin; reply STOP to opt out of messages.</p>
      <p><strong>Scope:</strong> private club – no public advertising, no unsolicited messages.</p>
      <p><strong>Contact:</strong> LMS Admin · clinters@me.com · Wirral, CH43 7QE · +447874469812</p>
    </div>
  </div>

  <script>
    // Open/close modals
    const modalRules   = document.getElementById('modalRules');
    const modalPrivacy = document.getElementById('modalPrivacy');
    const openRules = () => modalRules.classList.add('open');
    const openPrivacy = () => modalPrivacy.classList.add('open');
    document.getElementById('openRules')  .addEventListener('click', e => { e.preventDefault(); openRules(); });
    document.getElementById('openPrivacy').addEventListener('click', e => { e.preventDefault(); openPrivacy(); });
    document.getElementById('openRules2') .addEventListener('click', e => { e.preventDefault(); openRules(); });
    document.getElementById('openPrivacy2').addEventListener('click', e => { e.preventDefault(); openPrivacy(); });
    document.querySelectorAll('[data-close]').forEach(b => b.addEventListener('click', () => b.closest('.modal').classList.remove('open')));
    document.querySelectorAll('.modal').forEach(m => m.addEventListener('click', e => { if (e.target === m) m.classList.remove('open'); }));

    // Normalise phone to E.164-like
    const phone = document.getElementById('phone');
    phone.addEventListener('blur', () => {
      let p = phone.value.trim();
      if (p.startsWith('00')) p = '+' + p.slice(2);
      if (!p.startsWith('+')) p = '+' + p.replace(/[^\d]/g,'');
      p = p.replace(/\s+/g,'');
      phone.value = p;
    });

    // Submit using URL-encoded body to Apps Script
    const form = document.getElementById('reg');
    const btn  = document.getElementById('submitBtn');
    const msg  = document.getElementById('msg');
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbz5vb3AIYTjD7BRk7yHIx4zDrtqUasjtcMLf0NDQunX2Mmt_FIJZGNWcqr9I8h0Yg8/exec";

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!form.checkValidity()) { form.reportValidity(); return; }

      phone.dispatchEvent(new Event('blur')); // normalise first

      const data = new URLSearchParams(new FormData(form)); // classic form submit
      try {
        btn.disabled = true; btn.textContent = 'Submitting…';
        const res = await fetch(ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
          body: data.toString(),
          redirect: 'follow',
          mode: 'cors'
        });
        const text = await res.text();
        if (res.ok) {
          msg.className = 'msg ok';
          msg.innerHTML = '✅ Thanks! Your registration was received. You should get a WhatsApp confirmation shortly.';
          form.reset();
        } else {
          console.log('POST failed', res.status, text);
          msg.className = 'msg err';
          msg.innerHTML = '⚠️ Registration failed. Please try again.';
        }
      } catch (err) {
        console.error('Fetch error', err);
        msg.className = 'msg err';
        msg.innerHTML = '⚠️ Network error – please try again.';
      } finally {
        msg.style.display = 'block';
        btn.disabled = false; btn.textContent = 'Register';
      }
    });
  </script>
</body>
</html>
